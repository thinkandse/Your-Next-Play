<!-- everything works but edith finch is broken! -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Next Play</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheet.css') }}">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Your Next Play</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/quiz">Quiz</a></li>
                    <li class="nav-item"><a class="nav-link" href="/games">Games List</a></li>
                    <li class="nav-item"><a class="nav-link" href="/playlist">Play List</a></li>
                </ul>
                <form class="d-flex me-3">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
                <a href="#" class="me-3">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Netflix-avatar.png"
                         alt="profile" class="rounded-circle" width="40">
                </a>
                <a href="/login"><button class="btn btn-danger">Log in</button></a>
            </div>
        </div>
    </nav>

    <div class="body-content text-center mt-4">
        <p>Ready to find your perfect story game? What are you waiting for, let's go!</p>
    </div>

    <div class="quiz-rectangle text-center" id="quizBox">
        <button id="startQuizBtn" class="btn btn-danger">Start Quiz</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>

<script>
let quizAnswers = { device: [], duration: '', vibe: '', rating: '', money: '', interest: '' };

function anyOf(arr, allowed) {
    return arr.some(a => allowed.includes(a));
}
function durationIndex(d) {
    switch (d) {
        case 'less than 1 hour': return 0;
        case '1-2 hours': return 1;
        case '2-4 hours': return 2;
        case '5 hours or more': return 3;
        default: return -1;
    }
}
function loadQuestion(html) {
    document.getElementById('quizBox').innerHTML = html;
}

// === QUESTIONS ===
const deviceQuestion = `
<form id="deviceForm">
    <p style="color:#e75480;font-weight:bold;">What device can you play on? (Select all that apply)</p>
    <div class="form-check"><input class="form-check-input" type="checkbox" name="device" value="PC"> PC</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" name="device" value="Mobile"> Mobile</div>
    <div class="form-check"><input class="form-check-input" type="checkbox" name="device" value="Console"> Console</div>
    <button type="submit" class="btn btn-danger mt-3">Next</button>
</form>`;

const durationQuestion = `
<form id="durationForm">
    <p style="color:#e75480;font-weight:bold;">How long do you want to play for?</p>
    <div><label><input type="radio" name="duration" value="less than 1 hour" required> Less than 1 hour</label></div>
    <div><label><input type="radio" name="duration" value="1-2 hours"> 1-2 hours</label></div>
    <div><label><input type="radio" name="duration" value="2-4 hours"> 2-4 hours</label></div>
    <div><label><input type="radio" name="duration" value="5 hours or more"> 5 hours or more</label></div>
    <button type="submit" class="btn btn-danger mt-3">Next</button>
</form>`;

const vibeQuestion = `
<form id="vibeForm">
    <p style="color:#e75480;font-weight:bold;">Which sounds more appealing to you?</p>
    <div><label><input type="radio" name="vibe" value="quick slow burn" required> A quick but impactful slow burn story</label></div>
    <div><label><input type="radio" name="vibe" value="sad"> A really sad game to cry about</label></div>
    <div><label><input type="radio" name="vibe" value="character matters"> A slow burn, character matters!</label></div>
    <div><label><input type="radio" name="vibe" value="relatable"> An impactful game that's relatable and will be remembered</label></div>
    <button type="submit" class="btn btn-danger mt-3">Next</button>
</form>`;

const ratingQuestion = `
<form id="ratingForm">
    <p style="color:#e75480;font-weight:bold;">What's the highest age rating you can go?</p>
    <div><label><input type="radio" name="rating" value="G" required> G</label></div>
    <div><label><input type="radio" name="rating" value="PG"> PG</label></div>
    <div><label><input type="radio" name="rating" value="M"> M</label></div>
    <div><label><input type="radio" name="rating" value="MA"> MA</label></div>
    <button type="submit" class="btn btn-danger mt-3">Next</button>
</form>`;

const moneyQuestion = `
<form id="moneyForm">
    <p style="color:#e75480;font-weight:bold;">Are you willing to spend money to buy a game?</p>
    <div><label><input type="radio" name="money" value="Yes" required> Yes</label></div>
    <div><label><input type="radio" name="money" value="No"> No</label></div>
    <button type="submit" class="btn btn-danger mt-3">Next</button>
</form>`;

const interestQuestion = `
<form id="interestForm">
    <p style="color:#e75480;font-weight:bold;">What interests you most?</p>
    <div><label><input type="radio" name="interest" value="real life" required> Using my real-life actions like talking to control the game</label></div>
    <div><label><input type="radio" name="interest" value="popular"> A really popular game I can talk about</label></div>
    <div><label><input type="radio" name="interest" value="easy"> An easy-to-follow story</label></div>
    <div><label><input type="radio" name="interest" value="sit down"> A game where I can sit down and enjoy it</label></div>
    <button type="submit" class="btn btn-danger mt-3">Finish</button>
</form>`;

// Start quiz
document.getElementById('startQuizBtn').onclick = () => loadQuestion(deviceQuestion);

document.addEventListener('submit', e => {
    e.preventDefault();
    const f = e.target.id;
    if (f === 'deviceForm') {
        quizAnswers.device = Array.from(document.querySelectorAll('input[name="device"]:checked')).map(c => c.value);
        if (quizAnswers.device.length === 0) return alert('Please select at least one device.');
        loadQuestion(durationQuestion);
    } else if (f === 'durationForm') {
        quizAnswers.duration = document.querySelector('input[name="duration"]:checked').value;
        loadQuestion(vibeQuestion);
    } else if (f === 'vibeForm') {
        quizAnswers.vibe = document.querySelector('input[name="vibe"]:checked').value;
        loadQuestion(ratingQuestion);
    } else if (f === 'ratingForm') {
        quizAnswers.rating = document.querySelector('input[name="rating"]:checked').value;
        loadQuestion(moneyQuestion);
    } else if (f === 'moneyForm') {
        quizAnswers.money = document.querySelector('input[name="money"]:checked').value;
        loadQuestion(interestQuestion);
    } else if (f === 'interestForm') {
        quizAnswers.interest = document.querySelector('input[name="interest"]:checked').value;
        decideAndRedirect();
    }
});

// === MAIN LOGIC ===
function decideAndRedirect() {
    const q = quizAnswers;
    const durIdx = durationIndex(q.duration);

    // Real-life control filter
    if (q.interest === 'real life') {
        if (q.money === 'No') { window.location.href = '/severreco'; return; }
        else { window.location.href = '/beforeyoureyesreco'; return; }
    }

    const games = {
        sever: { path:'/severreco', dur:[0,1], vibe:['quick slow burn','relatable'], rating:['G','PG','M','MA'], money:'No' },
        expedition: { path:'/expeditionreco', dur:[0,1], vibe:['relatable','quick slow burn'], rating:['G','PG','M'], money:'No' },
        beforeyoureyes: { path:'/beforeyoureyesreco', dur:[1,2], vibe:['sad','relatable'], rating:['G','PG'], money:'Yes' },
        edith: { path:'/edithfinchreco', dur:[1,2], vibe:['sad','relatable'], rating:['M','MA'], money:'Yes' },
        firewatch: { path:'/firewatchreco', dur:[2,3], vibe:['character matters','relatable'], rating:['M','MA'], money:'Yes' },
        omori: { path:'/omorireco', dur:[3], vibe:['sad','relatable'], rating:['MA'], money:'Yes' }
    };

    let candidates = Object.entries(games).filter(([_, g]) => {
        if (!g.dur.includes(durIdx)) return false;
        if (!g.vibe.includes(q.vibe)) return false;
        if (g.money === 'No' && q.money === 'Yes') return false;
        if (g.money === 'Yes' && q.money === 'No') return false;
        return true;
    });

    const priority = ['beforeyoureyes','sever','expedition','edith','firewatch','omori'];
    candidates.sort((a,b)=>priority.indexOf(a[0])-priority.indexOf(b[0]));

    if (candidates.length>0){ window.location.href=candidates[0][1].path; return; }

    // Fallbacks
    if (q.money==='No'){ window.location.href=(q.interest==='easy'||q.interest==='sit down')?'/expeditionreco':'/severreco'; return;}
    if (durIdx===3){ window.location.href='/omorireco'; return; }
    if (durIdx>=2){ window.location.href='/firewatchreco'; return; }
    window.location.href='/edithfinchreco';
}
</script>
</body>
</html>
